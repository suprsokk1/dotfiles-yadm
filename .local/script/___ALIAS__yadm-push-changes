#!/usr/bin/env bash
command yadm status --porcelain=v1 |
    awk '/~$|\.elc$|\.pyc$/{system("yadm rm --cached -- "$NF)}
         /^ [ADM]/{system("yadm add "$NF)}
         END{(system("yadm status"))}'

echo -n 'OK?[yN]'
read confirm
case $confirm in
    [yY])
        command yadm commit && command yadm push
        ;;
    *)
esac
