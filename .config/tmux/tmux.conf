#-* - mode: conf[tmux] -*-
set -g base-index 1

#
# clipboard
#

set -s copy-command 'wl-copy'

# catch mouse events + copy mode on scroll
set -g mouse

#
# plugins
#

# required
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# theme
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'rickstaa/tmux-notify'
set -g @plugin 'jaclu/tmux-menus'

# fzf
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'roosta/tmux-fuzzback'

# theme plugin settings
set -g @catppuccin_flavor 'latte'



# backup: set-option -sa terminal-overrides ",xterm:Tc"
set-option -sa terminal-overrides ",xterm:Tc"
set-option -sa terminal-features ',rxvt-unicode-256color:clipboard'

set-option -g update-environment "DISPLAY WAYLAND_DISPLAY SWAYSOCK SSH_AUTH_SOCK"

# hooks
set-hook -g after-split-window "select-layout tiled"
set-hook -g after-kill-pane    "select-layout tiled"

# disable
unbind C-b
unbind -n C-t

# disable transpose characters
# bind C-t display-popup -E

set -g prefix C-Space
bind C-Space send-prefix

# bind -n M-Tab select-window -t'{last}'
# prev

# last
bind -n M-Tab select-pane -t'{last}'

bind -n M-Tab select-pane -t'{last}'
# bind -n C-Tab select-pane -t\! # last pane
bind -n C-\\ split-window
# bind -n C-| new-window
bind C-s setw synchronize-panes

# bind -n C-o

bind -n C-1 select-window -t1
bind -n C-2 select-window -t2
bind -n C-3 select-window -t3
bind -n C-4 select-window -t4

# bind t display-popup -B -E -e "FZF_DEFAULT_COMMAND=$HOME/.local/bin/tmux-helper.tmp" sh -c ''

unbind -T prefix t

# bind   -T prefix t -B -E -h 40 -w 80 /bin/sh -c 'btop || top'

bind u display-popup -E "sh -c 'tmux capturep -p -S - | fzf --ansi '"
bind p display-popup -E "sh -c 'tmux capturep -p -S - | fzf --ansi | xargs -I, -0 tmux send-keys '\'','\''"

bind -n M-y pipe-pane -I "wl-paste"
bind -n C-z resize-pane -Z

set -s command-alias hook='-s set-hook'
set -s command-alias cap='capture-pane -p -S - -t\!'
set -s command-alias capp='capture-pane -p -S - -t\!'
set -s command-alias capl='capture-pane -p -S - -t"{left}"'
set -s command-alias capr='capture-pane -p -S - -t"{right}"'

# >>>>>WORK IN PROGRESS>>>>>>
set -s command-alias man='display-popup "man $cmd" -e cmd='
set -s command-alias pass='pipe-pane -I pass\\  '
# <<<<<<WORK IN PROGRESS<<<<<<

bind r source $HOME/.config/tmux/tmux.conf

bind Tab display-popup -E -h 40a-w 80

# run "sh -c 'test -d ~/.local/share/tpm || git clone ~/src/tpm ~/.local/share/tpm; ~/.local/share/tpm/plugins/tpm/tpm'"
run "sh -c 'test -d ~/.local/share/tpm'|| env -C ~/.local/share/ git clone https://github.com/tmux-plugins/tpm; ~/.local/share/tpm/tpm"

#
set -g synchronize-panes off
set -g status off

### 'after-source-file' invalid hook?
# set-hook -g after-source-file "display-message '*** RELOADED ***'"

# bind -n C-t display-popup -B -E -e script=$HOME/.local/bin/tmux-helper.tmp bash -c '$script'
# bind -n C-t display-popup -B -E env cmd='$HOME/.local/bin/tmux-helper.tmp"' bash
# -E: Exit with command
# bind -n C-y pipe-command -I "wl-copy "

# display-popup [-BCE] [-b border-lines] [-c target-client] [-d start-directory] [-e environment] [-h
#         height] [-s style] [-S border-style] [-t target-pane] [-T title] [-w width] [-x position] [-y
#         position] [shell-command]
#               (alias: popup)
# display-popup -E -h 40 -w 50 -x 0 -y 0 neofetch
# display-popup -E -h 40 -w 80  neofetch

# set refresh-layout "select-layout tiled; run-shell '~/bin/,'"

# set-hook -g after-source-file  "display-message '*** RELOADED ***'"

# set-hook -g syn "set -g pane-border-style 'fg=colour235,bg=colour238'"
# set -g pane-border-style 'fg=colour235,bg=colour238'

# set -s paste-command 'wl-paste'
# set -s set-clipboard on
# set -s set-clipboard external
# set -s set-clipboard off

# bind -n C-t display-popup -E

# https://www.guyrutenberg.com/2021/07/02/tmux-wayland-clipboard-integration/

# TODO
# set -g automatic-rename-format '#{o}'
# set -s copy-command 'tee --append /run/user/$EUID/clipboard | wl-copy'
